<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DOPA4 ‚Äî Worksheet Distribuer</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg-deep: #0f1628;
  --bg-mid: #1a1f3a;
  --bg-card: rgba(255,255,255,0.025);
  --border-subtle: rgba(255,255,255,0.06);
  --border-focus: #4a7af5;
  --text-primary: #e8eaf0;
  --text-secondary: #c5ccde;
  --text-muted: #5a6a8a;
  --text-hint: #7b8ab8;
  --blue-accent: #60a5fa;
  --blue-deep: #4a7af5;
  --blue-glow: rgba(96,165,250,0.08);
  --purple-accent: #a78bfa;
  --green-accent: #6ecf8a;
  --green-bg: rgba(76,195,120,0.08);
  --gold-accent: #f5c842;
  --gold-bg: rgba(245,182,42,0.12);
  --red-soft: #f56565;
}

body {
  min-height: 100vh;
  background: linear-gradient(145deg, var(--bg-deep) 0%, var(--bg-mid) 40%, #0d1520 100%);
  font-family: 'Outfit', 'Segoe UI', sans-serif;
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
}

.container {
  max-width: 760px;
  margin: 0 auto;
  padding: 20px 16px 60px;
}

/* ===== HEADER ===== */
.header {
  text-align: center;
  padding: 32px 0 24px;
}
.header h1 {
  font-family: 'Space Mono', monospace;
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -1px;
  background: linear-gradient(135deg, #60a5fa, #a78bfa, #f0abfc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.header .subtitle {
  font-size: 13px;
  color: var(--text-hint);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-top: 6px;
}

/* ===== PROGRESS ===== */
.progress-bar {
  display: flex;
  gap: 6px;
  margin-bottom: 28px;
  padding: 0 4px;
}
.progress-seg {
  flex: 1;
  height: 4px;
  border-radius: 4px;
  background: rgba(255,255,255,0.06);
  transition: all 0.6s cubic-bezier(0.34,1.56,0.64,1);
}
.progress-seg.done {
  background: linear-gradient(90deg, #60a5fa, #a78bfa);
  box-shadow: 0 0 14px rgba(96,165,250,0.35);
}

/* ===== TABS ===== */
.tab-strip {
  display: flex;
  gap: 4px;
  background: rgba(255,255,255,0.03);
  border-radius: 14px;
  padding: 4px;
  margin-bottom: 24px;
  border: 1px solid rgba(255,255,255,0.04);
}
.tab-btn {
  flex: 1;
  padding: 10px 6px;
  border: none;
  background: transparent;
  color: var(--text-muted);
  font-family: 'Outfit', sans-serif;
  font-size: 11px;
  font-weight: 500;
  cursor: pointer;
  border-radius: 11px;
  transition: all 0.25s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}
.tab-btn:hover { color: #8b9cc5; }
.tab-btn.active {
  background: rgba(96,165,250,0.12);
  color: #a5c4fa;
  font-weight: 600;
  box-shadow: 0 2px 12px rgba(96,165,250,0.08);
}
.tab-emoji { font-size: 18px; }

/* ===== CONTENT PANELS ===== */
.panel { display: none; animation: fadeIn 0.35s ease; }
.panel.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.step-header {
  text-align: center;
  margin-bottom: 22px;
}
.step-header h2 {
  font-family: 'Space Mono', monospace;
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 6px;
}
.step-header p {
  font-size: 13px;
  color: var(--text-muted);
}

/* ===== CATEGORY BLOCKS ===== */
.cat-title {
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  font-weight: 700;
  margin: 0 0 10px;
  padding: 8px 14px;
  background: rgba(96,165,250,0.06);
  border-left: 3px solid var(--blue-deep);
  border-radius: 0 8px 8px 0;
  color: #93b4f5;
}

.field-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 14px;
  border-radius: 8px;
  transition: background 0.15s;
}
.field-row:hover { background: rgba(255,255,255,0.02); }
.field-label { flex: 1; }
.field-label .name { font-size: 14px; color: var(--text-secondary); }
.field-label .hint { font-size: 11px; color: var(--text-muted); margin-top: 1px; }

.field-input {
  width: 130px;
  padding: 8px 12px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 8px;
  color: var(--text-primary);
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  text-align: right;
  outline: none;
  transition: all 0.2s;
}
.field-input:focus {
  border-color: var(--blue-deep);
  background: rgba(74,122,245,0.08);
  box-shadow: 0 0 0 3px rgba(74,122,245,0.1);
}
.field-input::placeholder { color: #3a4560; }

/* ===== SUBTOTALS / TOTALS ===== */
.subtotal-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  margin: 4px 0 18px;
  border-top: 1px solid var(--border-subtle);
}
.subtotal-label { font-weight: 600; font-size: 13px; color: #93b4f5; }
.subtotal-value {
  font-family: 'Space Mono', monospace;
  font-size: 15px;
  font-weight: 700;
  color: #93b4f5;
  background: var(--blue-glow);
  padding: 4px 14px;
  border-radius: 6px;
}

.total-block {
  margin-top: 24px;
  padding: 18px 20px;
  background: linear-gradient(135deg, var(--gold-bg), rgba(245,142,42,0.08));
  border: 1px solid rgba(245,182,42,0.2);
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 8px;
}
.total-label {
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  font-weight: 700;
  color: #f5b62a;
}
.total-value {
  font-family: 'Space Mono', monospace;
  font-size: 22px;
  font-weight: 700;
  color: var(--gold-accent);
  text-shadow: 0 0 20px rgba(245,200,66,0.3);
}

.tip-box {
  margin-top: 16px;
  padding: 12px 16px;
  background: var(--green-bg);
  border: 1px solid rgba(76,195,120,0.15);
  border-radius: 10px;
  font-size: 13px;
  color: var(--green-accent);
  text-align: center;
  font-weight: 500;
}

/* ===== STEP 2 ‚Äî REVENUE ===== */
.section-title {
  font-family: 'Space Mono', monospace;
  font-size: 15px;
  font-weight: 700;
  color: #93b4f5;
  margin: 24px 0 12px;
  padding-bottom: 6px;
  border-bottom: 1px solid rgba(96,165,250,0.15);
}

.revenue-input {
  width: 100%;
  padding: 14px 18px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 12px;
  color: var(--text-primary);
  font-family: 'Space Mono', monospace;
  font-size: 20px;
  text-align: center;
  outline: none;
  transition: all 0.2s;
  margin-bottom: 16px;
}
.revenue-input:focus {
  border-color: var(--blue-deep);
  background: rgba(74,122,245,0.06);
  box-shadow: 0 0 0 3px rgba(74,122,245,0.1);
}
.revenue-input::placeholder { color: #3a4560; font-size: 16px; }

.info-row {
  display: flex;
  justify-content: space-between;
  padding: 6px 4px;
  font-size: 13px;
}
.info-row .label { color: var(--text-muted); }
.info-row .value { font-family: 'Space Mono', monospace; font-weight: 600; color: #93b4f5; }

.reste-block {
  display: flex;
  justify-content: space-between;
  padding: 10px 14px;
  background: rgba(96,165,250,0.06);
  border-radius: 8px;
  margin: 8px 0 20px;
  align-items: center;
}
.reste-label { font-size: 14px; font-weight: 600; color: #93b4f5; }
.reste-value {
  font-family: 'Space Mono', monospace;
  font-size: 18px;
  font-weight: 700;
}

/* ===== PERCENTAGE ROWS ===== */
.pct-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  margin-bottom: 6px;
  background: rgba(255,255,255,0.02);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.04);
  flex-wrap: wrap;
}
.pct-emoji { font-size: 22px; flex-shrink: 0; }
.pct-info { flex: 1; min-width: 120px; }
.pct-name { font-size: 14px; font-weight: 600; color: var(--text-secondary); }
.pct-desc { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
.pct-controls { display: flex; align-items: center; gap: 6px; }
.pct-btn {
  width: 32px;
  height: 32px;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(255,255,255,0.04);
  color: #8b9cc5;
  border-radius: 6px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
  font-family: 'Space Mono', monospace;
}
.pct-btn:hover { background: rgba(74,122,245,0.15); color: #a5c4fa; }
.pct-btn:active { transform: scale(0.92); }
.pct-val {
  font-family: 'Space Mono', monospace;
  font-size: 20px;
  font-weight: 700;
  width: 52px;
  text-align: center;
  color: var(--text-primary);
}
.pct-amount {
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  font-weight: 600;
  min-width: 90px;
  text-align: right;
}

.validation-msg {
  text-align: center;
  padding: 12px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  margin: 16px 0;
}
.validation-msg.ok {
  background: rgba(76,195,120,0.1);
  border: 1px solid rgba(76,195,120,0.2);
  color: var(--green-accent);
}
.validation-msg.warn {
  background: rgba(245,182,42,0.1);
  border: 1px solid rgba(245,182,42,0.2);
  color: #f5b62a;
}

/* ===== RECAP TABLE ===== */
.recap-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 4px;
  margin-top: 12px;
}
.recap-table th {
  font-size: 11px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 8px 12px;
  text-align: left;
  font-weight: 500;
}
.recap-table th:nth-child(2) { text-align: right; }
.recap-table td {
  padding: 10px 12px;
  font-size: 14px;
  background: rgba(255,255,255,0.02);
}
.recap-table tr td:first-child { border-radius: 8px 0 0 8px; color: var(--text-secondary); }
.recap-table tr td:nth-child(2) {
  font-family: 'Space Mono', monospace;
  font-weight: 600;
  text-align: right;
  color: #93b4f5;
}
.recap-table tr td:last-child { border-radius: 0 8px 8px 0; font-size: 12px; color: var(--text-muted); }
.recap-table tr.recap-total td {
  background: rgba(245,182,42,0.1);
  font-weight: 700;
  color: var(--gold-accent) !important;
}

/* ===== STEP 3 ‚Äî VIREMENTS ===== */
.timing-card {
  display: flex;
  gap: 16px;
  align-items: center;
  padding: 18px;
  background: var(--bg-card);
  border-radius: 12px;
  border: 1px solid var(--border-subtle);
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.timing-input {
  width: 70px;
  padding: 10px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  color: var(--text-primary);
  font-family: 'Space Mono', monospace;
  font-size: 20px;
  text-align: center;
  outline: none;
  transition: all 0.2s;
}
.timing-input:focus { border-color: var(--blue-deep); box-shadow: 0 0 0 3px rgba(74,122,245,0.1); }
.timing-label { font-size: 13px; color: #8b9cc5; margin-bottom: 4px; }
.timing-result {
  padding: 10px 18px;
  background: rgba(76,195,120,0.1);
  border: 1px solid rgba(76,195,120,0.15);
  border-radius: 8px;
  font-family: 'Space Mono', monospace;
  font-size: 20px;
  font-weight: 700;
  color: var(--green-accent);
}
.timing-arrow { font-size: 26px; color: var(--blue-deep); }
.timing-note { font-size: 11px; color: var(--text-muted); font-style: italic; }

.virement-card {
  padding: 14px 16px;
  margin-bottom: 6px;
  background: rgba(255,255,255,0.02);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.04);
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.vir-arrow { color: var(--blue-deep); font-size: 18px; flex-shrink: 0; }
.vir-tag {
  font-size: 12px;
  padding: 4px 10px;
  border-radius: 6px;
  font-weight: 500;
  white-space: nowrap;
}
.vir-from { background: rgba(255,255,255,0.05); color: #8b9cc5; }
.vir-to { background: rgba(96,165,250,0.1); color: #93b4f5; }
.vir-details { margin-left: auto; text-align: right; }
.vir-amount {
  font-family: 'Space Mono', monospace;
  font-size: 15px;
  font-weight: 700;
  color: var(--text-primary);
}
.vir-label-text {
  font-size: 10px;
  color: var(--text-muted);
  font-family: 'Space Mono', monospace;
  letter-spacing: 0.5px;
  margin-top: 2px;
}

/* ===== CHECKLIST ===== */
.checklist-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  cursor: pointer;
  border-radius: 8px;
  transition: background 0.15s;
  user-select: none;
}
.checklist-item:hover { background: rgba(255,255,255,0.02); }
.check-box {
  width: 24px;
  height: 24px;
  border-radius: 6px;
  border: 2px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.03);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  flex-shrink: 0;
  font-size: 14px;
  color: transparent;
}
.check-box.checked {
  background: rgba(76,195,120,0.2);
  border-color: var(--green-accent);
  color: var(--green-accent);
}
.check-text { font-size: 14px; color: var(--text-secondary); transition: all 0.2s; }
.check-text.done { text-decoration: line-through; color: var(--text-muted); }

/* ===== STEP 4 ‚Äî PLAN ACTION ===== */
.action-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  margin-bottom: 4px;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.15s;
}
.action-row:hover { background: rgba(255,255,255,0.02); }
.action-day {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  font-weight: 700;
  padding: 4px 10px;
  border-radius: 6px;
  white-space: nowrap;
  min-width: 66px;
  text-align: center;
}
.action-task { flex: 1; font-size: 14px; color: var(--text-secondary); transition: all 0.2s; }
.action-task.done { text-decoration: line-through; color: var(--text-muted); }
.action-dur {
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  color: var(--text-muted);
  white-space: nowrap;
}

.quote-block {
  margin-top: 20px;
  padding: 16px;
  background: var(--bg-card);
  border-radius: 12px;
  border: 1px solid var(--border-subtle);
  text-align: center;
}
.quote-title { font-size: 14px; font-weight: 600; color: #93b4f5; margin-bottom: 6px; }
.quote-text { font-size: 13px; color: #8b9cc5; font-style: italic; }

/* ===== BUTTONS ===== */
.next-btn {
  display: block;
  width: 100%;
  padding: 15px;
  margin-top: 24px;
  background: linear-gradient(135deg, #4a7af5, #6b5ce7);
  border: none;
  border-radius: 12px;
  color: white;
  font-family: 'Outfit', sans-serif;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: 0.5px;
}
.next-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 24px rgba(74,122,245,0.3);
}
.next-btn:active { transform: translateY(0); }

.btn-group {
  display: flex;
  gap: 10px;
  margin-top: 24px;
}
.btn-group .next-btn { flex: 1; }
.btn-secondary {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
}
.btn-secondary:hover {
  background: rgba(255,255,255,0.1);
  box-shadow: none;
}

/* ===== FOOTER ===== */
.footer {
  text-align: center;
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid var(--border-subtle);
}
.footer p { font-size: 12px; color: var(--text-muted); }
.footer .book-title { color: #93b4f5; font-weight: 600; }

/* ===== PRINT ===== */
@media print {
  body { background: white !important; color: #1a1a2e !important; }
  .container { max-width: 100%; padding: 10px; }
  .tab-strip, .next-btn, .btn-group, .progress-bar, .footer { display: none !important; }
  .panel { display: block !important; page-break-inside: avoid; margin-bottom: 30px; }
  * { color: #1a1a2e !important; border-color: #ccc !important; }
  .header h1 { -webkit-text-fill-color: #2B579A; background: none; }
  .cat-title, .section-title { background: #f0f4ff !important; color: #2B579A !important; }
  .total-block, .recap-table tr.recap-total td { background: #fff3cd !important; }
  .subtotal-value, .reste-block { background: #e8f0fe !important; }
  .field-input, .revenue-input, .timing-input { border: 1px solid #999 !important; background: #fafafa !important; }
  .tip-box { background: #e8f5e9 !important; border-color: #a5d6a7 !important; color: #2e7d32 !important; }
  .pct-btn { display: none; }
  .check-box { border-color: #999 !important; }
}

/* ===== RESPONSIVE ===== */
@media (max-width: 600px) {
  .tab-btn { font-size: 9px; padding: 8px 4px; }
  .tab-emoji { font-size: 14px; }
  .field-row { flex-wrap: wrap; }
  .field-input { width: 100%; }
  .pct-row { gap: 8px; }
  .pct-amount { width: 100%; text-align: left; margin-top: 4px; }
  .virement-card { gap: 6px; }
  .vir-details { width: 100%; text-align: left; margin-left: 0; margin-top: 6px; }
  .header h1 { font-size: 22px; }
  .timing-card { flex-direction: column; align-items: stretch; text-align: center; }
  .timing-arrow { transform: rotate(90deg); }
  .btn-group { flex-direction: column; }
}
</style>
</head>
<body>

<div class="container">

  <!-- HEADER -->
  <div class="header">
    <h1>M√âTHODE DOPA4</h1>
    <div class="subtitle">Worksheet ‚Äî Distribuer</div>
  </div>

  <!-- PROGRESS BAR -->
  <div class="progress-bar">
    <div class="progress-seg" id="prog1"></div>
    <div class="progress-seg" id="prog2"></div>
    <div class="progress-seg" id="prog3"></div>
    <div class="progress-seg" id="prog4"></div>
  </div>

  <!-- TABS -->
  <div class="tab-strip">
    <button class="tab-btn active" onclick="switchTab(1)" id="tabBtn1">
      <span class="tab-emoji">üìä</span>Charges Fixes
    </button>
    <button class="tab-btn" onclick="switchTab(2)" id="tabBtn2">
      <span class="tab-emoji">üìê</span>R√©partition
    </button>
    <button class="tab-btn" onclick="switchTab(3)" id="tabBtn3">
      <span class="tab-emoji">‚öôÔ∏è</span>Virements
    </button>
    <button class="tab-btn" onclick="switchTab(4)" id="tabBtn4">
      <span class="tab-emoji">üöÄ</span>Plan d'Action
    </button>
  </div>

  <!-- =============== PANEL 1 : CHARGES FIXES =============== -->
  <div class="panel active" id="panel1">
    <div class="step-header">
      <h2>üìä Calcul des Charges Fixes</h2>
      <p>‚è±Ô∏è 30 min ¬∑ Savoir ce qui DOIT √™tre pay√© chaque mois</p>
    </div>

    <!-- LOGEMENT -->
    <div class="cat-title">üè† LOGEMENT</div>
    <div class="field-row">
      <div class="field-label"><div class="name">Loyer / Cr√©dit immobilier</div><div class="hint">Montant mensuel</div></div>
      <input class="field-input charge-input" data-cat="0" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Charges de copropri√©t√©</div><div class="hint">Si applicable</div></div>
      <input class="field-input charge-input" data-cat="0" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Assurance habitation</div><div class="hint">Mensualiser si annuel</div></div>
      <input class="field-input charge-input" data-cat="0" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Taxe d'habitation</div><div class="hint">√∑ 12 si annuel</div></div>
      <input class="field-input charge-input" data-cat="0" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="subtotal-row">
      <span class="subtotal-label">Sous-total Logement</span>
      <span class="subtotal-value" id="sub0">0,00 ‚Ç¨</span>
    </div>

    <!-- √âNERGIE -->
    <div class="cat-title">‚ö° √âNERGIE & COMMUNICATION</div>
    <div class="field-row">
      <div class="field-label"><div class="name">√âlectricit√©</div><div class="hint">Moyenne sur 3 mois</div></div>
      <input class="field-input charge-input" data-cat="1" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Gaz</div><div class="hint">Si applicable</div></div>
      <input class="field-input charge-input" data-cat="1" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Eau</div><div class="hint">Souvent trimestriel √∑ 3</div></div>
      <input class="field-input charge-input" data-cat="1" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Internet / Box</div><div class="hint">Fixe</div></div>
      <input class="field-input charge-input" data-cat="1" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">T√©l√©phone mobile</div><div class="hint">Forfait mensuel</div></div>
      <input class="field-input charge-input" data-cat="1" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="subtotal-row">
      <span class="subtotal-label">Sous-total √ânergie & Com</span>
      <span class="subtotal-value" id="sub1">0,00 ‚Ç¨</span>
    </div>

    <!-- ASSURANCES -->
    <div class="cat-title">üè• ASSURANCES & SANT√â</div>
    <div class="field-row">
      <div class="field-label"><div class="name">Mutuelle sant√©</div><div class="hint">Pr√©l√®vement mensuel</div></div>
      <input class="field-input charge-input" data-cat="2" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Assurance auto/moto</div><div class="hint">√∑ 12 si annuel</div></div>
      <input class="field-input charge-input" data-cat="2" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Autres assurances</div><div class="hint">Animaux, objets...</div></div>
      <input class="field-input charge-input" data-cat="2" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="subtotal-row">
      <span class="subtotal-label">Sous-total Assurances</span>
      <span class="subtotal-value" id="sub2">0,00 ‚Ç¨</span>
    </div>

    <!-- ABONNEMENTS -->
    <div class="cat-title">üì± ABONNEMENTS ESSENTIELS</div>
    <div class="field-row">
      <div class="field-label"><div class="name">Transport (m√©tro, train...)</div><div class="hint">Abonnement mensuel</div></div>
      <input class="field-input charge-input" data-cat="3" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Garde d'enfants / Cr√®che</div><div class="hint">Si applicable</div></div>
      <input class="field-input charge-input" data-cat="3" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Remboursement cr√©dit conso</div><div class="hint">Mensualit√© fixe</div></div>
      <input class="field-input charge-input" data-cat="3" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Pension alimentaire</div><div class="hint">Si applicable</div></div>
      <input class="field-input charge-input" data-cat="3" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Autre fixe 1</div><div class="hint"></div></div>
      <input class="field-input charge-input" data-cat="3" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="field-row">
      <div class="field-label"><div class="name">Autre fixe 2</div><div class="hint"></div></div>
      <input class="field-input charge-input" data-cat="3" type="text" inputmode="decimal" placeholder="0,00 ‚Ç¨" oninput="recalc()">
    </div>
    <div class="subtotal-row">
      <span class="subtotal-label">Sous-total Abonnements</span>
      <span class="subtotal-value" id="sub3">0,00 ‚Ç¨</span>
    </div>

    <div class="total-block">
      <span class="total-label">üí∞ TOTAL CHARGES FIXES</span>
      <span class="total-value" id="totalCharges">0,00 ‚Ç¨</span>
    </div>

    <div class="tip-box">‚úÖ Tu h√©sites ? Arrondis AU-DESSUS. Une estimation honn√™te suffit !</div>

    <button class="next-btn" onclick="switchTab(2)">Continuer ‚Üí √âtape 2 : R√©partition</button>
  </div>

  <!-- =============== PANEL 2 : R√âPARTITION DOPA4 =============== -->
  <div class="panel" id="panel2">
    <div class="step-header">
      <h2>üìê Calculer tes Pourcentages</h2>
      <p>‚è±Ô∏è 15 min ¬∑ Trouver TON √©quilibre r√©aliste</p>
    </div>

    <div class="section-title">üíµ Tes Revenus Mensuels</div>
    <input class="revenue-input" id="revenusInput" type="text" inputmode="decimal" placeholder="Ton salaire net mensuel (‚Ç¨)" oninput="recalc()">

    <div class="info-row">
      <span class="label">Charges fixes (onglet 1)</span>
      <span class="value" id="chargesRef">0,00 ‚Ç¨</span>
    </div>
    <div class="reste-block">
      <span class="reste-label">Reste √† r√©partir</span>
      <span class="reste-value" id="resteValue" style="color: var(--green-accent);">0,00 ‚Ç¨</span>
    </div>

    <div class="section-title">üéØ R√©partition du Reste</div>

    <div class="pct-row">
      <span class="pct-emoji">üõí</span>
      <div class="pct-info">
        <div class="pct-name">D√©penses courantes</div>
        <div class="pct-desc">Courses, essence, sorties...</div>
      </div>
      <div class="pct-controls">
        <button class="pct-btn" onclick="adjustPct('courantes',-5)">‚àí</button>
        <span class="pct-val" id="pctCourantes">60%</span>
        <button class="pct-btn" onclick="adjustPct('courantes',5)">+</button>
      </div>
      <span class="pct-amount" id="amtCourantes" style="color: var(--blue-accent);">0,00 ‚Ç¨</span>
    </div>

    <div class="pct-row">
      <span class="pct-emoji">üòä</span>
      <div class="pct-info">
        <div class="pct-name">Plaisir / Dopamine</div>
        <div class="pct-desc">Ce qui te fait du bien SANS CULPABILIT√â</div>
      </div>
      <div class="pct-controls">
        <button class="pct-btn" onclick="adjustPct('plaisir',-5)">‚àí</button>
        <span class="pct-val" id="pctPlaisir">20%</span>
        <button class="pct-btn" onclick="adjustPct('plaisir',5)">+</button>
      </div>
      <span class="pct-amount" id="amtPlaisir" style="color: var(--purple-accent);">0,00 ‚Ç¨</span>
    </div>

    <div class="pct-row">
      <span class="pct-emoji">üõ°Ô∏è</span>
      <div class="pct-info">
        <div class="pct-name">S√©curit√© / √âpargne</div>
        <div class="pct-desc">Matelas de s√©curit√© automatique</div>
      </div>
      <div class="pct-controls">
        <button class="pct-btn" onclick="adjustPct('epargne',-5)">‚àí</button>
        <span class="pct-val" id="pctEpargne">20%</span>
        <button class="pct-btn" onclick="adjustPct('epargne',5)">+</button>
      </div>
      <span class="pct-amount" id="amtEpargne" style="color: var(--green-accent);">0,00 ‚Ç¨</span>
    </div>

    <div class="validation-msg ok" id="validationMsg">‚úÖ Parfait ! Tes pourcentages totalisent 100%</div>

    <div class="section-title">üìä R√©capitulatif Complet</div>
    <table class="recap-table">
      <thead><tr><th>Poste</th><th>Montant</th><th>Destination</th></tr></thead>
      <tbody>
        <tr><td>Charges fixes</td><td id="recapCharges">0,00 ‚Ç¨</td><td>Automatique J+1</td></tr>
        <tr><td>D√©penses courantes</td><td id="recapCourantes">0,00 ‚Ç¨</td><td>Compte courant</td></tr>
        <tr><td>Plaisir / Dopamine</td><td id="recapPlaisir">0,00 ‚Ç¨</td><td>Compte d√©di√©</td></tr>
        <tr><td>√âpargne / S√©curit√©</td><td id="recapEpargne">0,00 ‚Ç¨</td><td>Livret A</td></tr>
        <tr class="recap-total"><td>TOTAL</td><td id="recapTotal">0,00 ‚Ç¨</td><td></td></tr>
      </tbody>
    </table>

    <button class="next-btn" onclick="switchTab(3)">Continuer ‚Üí √âtape 3 : Virements</button>
  </div>

  <!-- =============== PANEL 3 : VIREMENTS AUTO =============== -->
  <div class="panel" id="panel3">
    <div class="step-header">
      <h2>‚öôÔ∏è Configuration des Virements</h2>
      <p>üéØ Configure UNE FOIS, puis n'y touche plus !</p>
    </div>

    <div class="section-title">üìÖ Timing Critique</div>
    <div class="timing-card">
      <div>
        <div class="timing-label">Jour de r√©ception salaire</div>
        <input class="timing-input" id="jourSalaire" type="text" inputmode="numeric" placeholder="28" maxlength="2" oninput="recalc()">
      </div>
      <div class="timing-arrow">‚Üí</div>
      <div>
        <div class="timing-label" style="color: var(--green-accent); font-weight: 600;">Virements auto le</div>
        <div class="timing-result" id="jourVirement">‚Äî</div>
      </div>
      <div class="timing-note">‚Üê LE LENDEMAIN</div>
    </div>

    <div class="section-title">üí∏ Mes Virements Automatiques</div>
    <div id="virementsContainer"></div>

    <div class="section-title">‚úÖ Checklist Configuration</div>
    <div id="checklistContainer"></div>

    <div class="tip-box" style="margin-top: 16px;">üéâ Bravo ! Une fois fait, tu n'y touches PLUS pendant 3 mois minimum.</div>

    <button class="next-btn" onclick="switchTab(4)">Continuer ‚Üí √âtape 4 : Plan d'Action</button>
  </div>

  <!-- =============== PANEL 4 : PLAN ACTION =============== -->
  <div class="panel" id="panel4">
    <div class="step-header">
      <h2>üöÄ Une Chose √† la Fois</h2>
      <p>Ne fais pas tout aujourd'hui. Suis ce plan sur UNE SEMAINE.</p>
    </div>

    <div id="actionContainer"></div>

    <div class="total-block" style="margin-top: 20px;">
      <span class="total-label">Temps total sur la semaine</span>
      <span class="total-value">~2h</span>
    </div>

    <div class="quote-block">
      <div class="quote-title">üí° Rappel du Chapitre</div>
      <div class="quote-text">"Distribuer, c'est d√©cider UNE SEULE FOIS comment ton argent est r√©parti ‚Äî puis laisser le syst√®me ex√©cuter."</div>
    </div>

    <div class="tip-box" style="margin-top: 16px;">üß† Le lendemain de chaque revenu, l'argent est automatiquement distribu√©. Tu n'as plus besoin d'y penser.</div>

    <div class="btn-group">
      <button class="next-btn btn-secondary" onclick="window.print()">üñ®Ô∏è Imprimer / PDF</button>
      <button class="next-btn" onclick="exportData()">üì• Exporter mes donn√©es</button>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <p>Extrait du livre <span class="book-title">TDAH ADULTE ‚Äî G√©rer son argent sans volont√© ni discipline</span></p>
    <p style="margin-top: 4px;">La M√©thode DOPA4 ¬∑ ¬© Tous droits r√©serv√©s</p>
  </div>

</div>

<script>
// ===== STATE =====
const state = {
  pct: { courantes: 60, plaisir: 20, epargne: 20 },
  checklist: Array(8).fill(false),
  actions: Array(7).fill(false)
};

// ===== FORMAT =====
function fmt(n) {
  if (typeof n !== 'number' || isNaN(n)) n = 0;
  return n.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' ‚Ç¨';
}
function parseNum(s) {
  if (!s) return 0;
  return parseFloat(s.replace(/\s/g, '').replace(',', '.')) || 0;
}

// ===== TABS =====
function switchTab(n) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('panel' + n).classList.add('active');
  document.getElementById('tabBtn' + n).classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
  recalc();
}

// ===== RECALC ALL =====
function recalc() {
  // Subtotals by category
  const subs = [0, 0, 0, 0];
  document.querySelectorAll('.charge-input').forEach(input => {
    const cat = parseInt(input.dataset.cat);
    subs[cat] += parseNum(input.value);
  });
  for (let i = 0; i < 4; i++) {
    document.getElementById('sub' + i).textContent = fmt(subs[i]);
  }

  const totalCharges = subs.reduce((a, b) => a + b, 0);
  document.getElementById('totalCharges').textContent = fmt(totalCharges);

  // Step 2
  const revenus = parseNum(document.getElementById('revenusInput').value);
  const reste = revenus - totalCharges;

  document.getElementById('chargesRef').textContent = fmt(totalCharges);
  const resteEl = document.getElementById('resteValue');
  resteEl.textContent = fmt(reste);
  resteEl.style.color = reste >= 0 ? 'var(--green-accent)' : 'var(--red-soft)';

  const montants = {
    courantes: reste * state.pct.courantes / 100,
    plaisir: reste * state.pct.plaisir / 100,
    epargne: reste * state.pct.epargne / 100
  };

  document.getElementById('pctCourantes').textContent = state.pct.courantes + '%';
  document.getElementById('pctPlaisir').textContent = state.pct.plaisir + '%';
  document.getElementById('pctEpargne').textContent = state.pct.epargne + '%';
  document.getElementById('amtCourantes').textContent = fmt(montants.courantes);
  document.getElementById('amtPlaisir').textContent = fmt(montants.plaisir);
  document.getElementById('amtEpargne').textContent = fmt(montants.epargne);

  const totalPct = state.pct.courantes + state.pct.plaisir + state.pct.epargne;
  const valMsg = document.getElementById('validationMsg');
  if (totalPct === 100) {
    valMsg.className = 'validation-msg ok';
    valMsg.textContent = '‚úÖ Parfait ! Tes pourcentages totalisent 100%';
  } else {
    valMsg.className = 'validation-msg warn';
    valMsg.textContent = '‚ö†Ô∏è Total = ' + totalPct + '% ‚Äî Ajuste pour arriver √† 100%';
  }

  // Recap
  document.getElementById('recapCharges').textContent = fmt(totalCharges);
  document.getElementById('recapCourantes').textContent = fmt(montants.courantes);
  document.getElementById('recapPlaisir').textContent = fmt(montants.plaisir);
  document.getElementById('recapEpargne').textContent = fmt(montants.epargne);
  document.getElementById('recapTotal').textContent = fmt(revenus);

  // Step 3 ‚Äî timing
  const jour = parseInt(document.getElementById('jourSalaire').value);
  document.getElementById('jourVirement').textContent = jour ? 'J ' + Math.min(jour + 1, 31) : '‚Äî';

  // Step 3 ‚Äî virements
  renderVirements(totalCharges, montants);

  // Progress bar
  document.getElementById('prog1').className = 'progress-seg' + (totalCharges > 0 ? ' done' : '');
  document.getElementById('prog2').className = 'progress-seg' + (revenus > 0 && totalPct === 100 ? ' done' : '');
  document.getElementById('prog3').className = 'progress-seg' + (jour > 0 ? ' done' : '');
  document.getElementById('prog4').className = 'progress-seg' + (state.actions.filter(Boolean).length >= 5 ? ' done' : '');
}

// ===== PERCENTAGES =====
function adjustPct(key, delta) {
  state.pct[key] = Math.max(0, Math.min(100, state.pct[key] + delta));
  recalc();
}

// ===== VIREMENTS RENDER =====
function renderVirements(totalCharges, montants) {
  const data = [
    { from: 'Compte principal', to: 'Compte Charges', amount: totalCharges, label: 'VIR AUTO CHARGES' },
    { from: 'Compte principal', to: 'Compte Courant', amount: montants.courantes, label: 'VIR AUTO QUOTIDIEN' },
    { from: 'Compte principal', to: 'Compte Plaisir', amount: montants.plaisir, label: 'VIR AUTO DOPAMINE' },
    { from: 'Compte principal', to: 'Livret A', amount: montants.epargne, label: 'VIR AUTO √âPARGNE' },
  ];

  const container = document.getElementById('virementsContainer');
  container.innerHTML = data.map(v => `
    <div class="virement-card">
      <span class="vir-tag vir-from">${v.from}</span>
      <span class="vir-arrow">‚Üí</span>
      <span class="vir-tag vir-to">${v.to}</span>
      <div class="vir-details">
        <div class="vir-amount">${fmt(v.amount)}</div>
        <div class="vir-label-text">${v.label}</div>
      </div>
    </div>
  `).join('');
}

// ===== CHECKLIST =====
function initChecklist() {
  const items = [
    "J'ai ouvert tous les comptes n√©cessaires",
    "J'ai not√© les IBAN de chaque compte",
    "J'ai configur√© le virement 1 : Charges fixes",
    "J'ai configur√© le virement 2 : D√©penses courantes",
    "J'ai configur√© le virement 3 : Plaisir",
    "J'ai configur√© le virement 4 : √âpargne",
    "J'ai v√©rifi√© que la date = J+1 apr√®s salaire",
    "J'ai activ√© les notifications par SMS/email"
  ];

  const container = document.getElementById('checklistContainer');
  container.innerHTML = items.map((text, i) => `
    <div class="checklist-item" onclick="toggleCheck(${i})">
      <span class="check-box" id="check${i}">‚úì</span>
      <span class="check-text" id="checkText${i}">${text}</span>
    </div>
  `).join('');
}

function toggleCheck(i) {
  state.checklist[i] = !state.checklist[i];
  const box = document.getElementById('check' + i);
  const text = document.getElementById('checkText' + i);
  box.className = 'check-box' + (state.checklist[i] ? ' checked' : '');
  text.className = 'check-text' + (state.checklist[i] ? ' done' : '');
}

// ===== ACTION PLAN =====
function initActions() {
  const actions = [
    { day: 'JOUR 1', task: "Remplir l'onglet 1 (Charges fixes)", dur: '30 min', color: '#2d4a2e', textColor: '#93d5a0' },
    { day: 'JOUR 2', task: "Remplir l'onglet 2 (Pourcentages)", dur: '15 min', color: '#2d4a2e', textColor: '#93d5a0' },
    { day: 'JOUR 3', task: 'Identifier les comptes manquants', dur: '10 min', color: '#4a4528', textColor: '#e5d88a' },
    { day: 'JOUR 4', task: 'Ouvrir le(s) compte(s) n√©o-banque', dur: '20 min', color: '#4a4528', textColor: '#e5d88a' },
    { day: 'JOUR 5', task: 'Configurer virement 1 et 2', dur: '15 min', color: '#283a52', textColor: '#93b4f5' },
    { day: 'JOUR 6', task: 'Configurer virement 3 et 4', dur: '15 min', color: '#283a52', textColor: '#93b4f5' },
    { day: 'JOUR 7', task: 'V√©rifier les dates et activer', dur: '10 min', color: '#2d4a2e', textColor: '#93d5a0' },
  ];

  const container = document.getElementById('actionContainer');
  container.innerHTML = actions.map((a, i) => `
    <div class="action-row" onclick="toggleAction(${i})">
      <span class="check-box" id="actionBox${i}">‚úì</span>
      <span class="action-day" style="background:${a.color};color:${a.textColor}">${a.day}</span>
      <span class="action-task" id="actionTask${i}">${a.task}</span>
      <span class="action-dur">${a.dur}</span>
    </div>
  `).join('');
}

function toggleAction(i) {
  state.actions[i] = !state.actions[i];
  const box = document.getElementById('actionBox' + i);
  const task = document.getElementById('actionTask' + i);
  box.className = 'check-box' + (state.actions[i] ? ' checked' : '');
  task.className = 'action-task' + (state.actions[i] ? ' done' : '');
  recalc();
}

// ===== EXPORT =====
function exportData() {
  const charges = {};
  document.querySelectorAll('.charge-input').forEach((input, i) => {
    if (input.value) {
      const label = input.closest('.field-row').querySelector('.name').textContent;
      charges[label] = input.value;
    }
  });

  const data = {
    date: new Date().toLocaleDateString('fr-FR'),
    charges_fixes: charges,
    total_charges: document.getElementById('totalCharges').textContent,
    revenus: document.getElementById('revenusInput').value,
    repartition: {
      courantes: state.pct.courantes + '%',
      plaisir: state.pct.plaisir + '%',
      epargne: state.pct.epargne + '%'
    },
    jour_salaire: document.getElementById('jourSalaire').value,
    jour_virements: document.getElementById('jourVirement').textContent
  };

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'mes-donnees-dopasysteme.json';
  a.click();
  URL.revokeObjectURL(url);
}

// ===== INIT =====
initChecklist();
initActions();
recalc();
</script>

</body>
</html>
